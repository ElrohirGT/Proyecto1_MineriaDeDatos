---
title: "CineVision - Clustering, Apriori, PCA"
author: "Flavio Galán, José Prince"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: paper
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

[Repositorio](https://github.com/ElrohirGT/Proyecto1_MineriaDeDatos.git)

# Prepocesamiento de los datos
```{r}
library(cluster) 
library(hopkins)
library(factoextra)
library(ggplot2)
library(fpc)

datos <- read.csv("../data/movies.csv")
datos_num <- datos[, sapply(datos, is.numeric)]
datos_num <- datos_num[, -1]
```

Acá podemos encontrar las siguientes variables: **`r colnames(datos)`**. 

Para el análisis de los datos solo se necesitaran de las variables que se categorizaron como cuantitativas durante el análisis exploratorio. Se toma esta decisión debido a que en los métodos de clustering a utilizar se basan en variables cuantitativas por lo que para evitar ambiguedades se omite el agrupamiente de este tipo de variables y obtener un mejor resultado en el agrupamiento de datos. De igual forma otra variable que no aporta información al agrupamiento es justamente la que contiene el id de los datos, en este caso siendo "id", esto se debe a que esta variable al agruparla no aporta ningún tipo de información. 

Obteniendo las siguientes columnas a analizar: **`r colnames(datos_num)`**.

Viendo con más detalle cada una de las variables escogidas.

- budget: el presupuesto utilizado para la película.
- revenue: las ganancias de la película. 
- runtime: duración total de la película.
- popularity: índice de popularidad de la película, calculada semanalmente.
- voteAvg: promedio de votos para la película.
- voteCount: número de votos para la película.
- genresAmount: cantidad total de generos destinados a una película.
- productionCoAmount: cantidad de compañías productoras que participaron en la película.
- productionCountriesAmount: cantidad de países en los que se rodó la película.
- actorsAmount: cantidad de personas que actuan en la película.

# Hopkings y VAT
```{r iniciso 2}
set.seed(123)
datos_dist <- dist(head(datos_num, 300))
fviz_dist(datos_dist, show_labels = F)
```
Analizando el estadístico de Hopkings obtenemos que su valor es de **`hopkins(datos_num)`**, esto nos indica que los datos tienen una fuerte estructura de agrupamiento. Para corrobar que existan grupos de datos, se realiza la "Evaluación Visual de Tendencia".

```{r VAT}
datos_dist <- dist(head(datos_num, 300))
fviz_dist(datos_dist, show_labels = F)
```
La EVT (evaluación visuald e tendencia) se hizo con una muestra de 300 debido a que el dataset era muy grande para procesarlo por completo y vemos que existe una tendencia de agrupamiento para los datos.

# Método de codo

```{r Método de codo}
fviz_nbclust(datos_num, kmeans, method = "wss") + ggtitle("Metodo de Codo")
```

Evaluando el dataset con el método de codo se demuestra que es mejor agrupar los datos en un total de 3 grupos para poder obtener la mayor información de cada uno de los grupos de datos. Se hace la elección de 3 grupos debido a que es donde se presenta el mayor cambio de pendiente en la gráfica.

# K-medias y CLustering jerárquico

Este es el gráfico obtenido de K-medias:

```{r K-means}
km <- kmeans(datos_num, 3,iter.max =100)
plotcluster(datos_num, km$cluster)
```

Este es el el dendograma que se genera para el clustering jerárquico:

```{r Agrupamiento jerarquico}
dist_matrix <- dist(datos_num, method = "euclidean")
hc <- hclust(dist_matrix, method = "complete")

plot(hc, main="Dendograma", xlab="Observaciones", ylab="Distancia")
clusters <- cutree(hc, k=3)
```

Haciendo una comparación entre la gráfica obtenida por K-Means y por el dendograma del agrupamiento jerarquico podemos ver que los datos se separan en tres grupos principales, indicado anteriormente por el método de codo. A su vez podemos ver que uno de los grupos se encuentra más disperso, debido a las limitaciones de software esto no es visible en el dendograma pero sí en K-means.

# Método de la silueta

Este método nos ayudará a determinar la calidad del agrupamiento. Midiendo qué tan bien están agrupados los puntos dentro de su cluster y qué tan separados están de otros clusters. A continuación se muestra el gráfico del método de la silueta para los métodos de clusterings anteriores. 

```{r Silhouette km}
sil <- silhouette(km$cluster, dist(datos_num))
plot(sil, col=1:3, border=NA)

sil <- silhouette(clusters, dist(datos_num))
plot(sil, col=1:3, border=NA)

```

Se puede apreciar que ambos métodos de clustering agrupan correctamente cada punto en su respectivo cluster. Esto lo sabemos cuando vemos el valor de "average silhouette width" que es 0.8 y 0.93 para K-means y hc (hierarchy clustering); si este valor hubiera sido cercano a 0 nos indicaria que el clustering no es muy claro o no esta bien definido, en caso de ser un número negativo sugiere que la asignación de los clusters podría ser incorrecta. 
